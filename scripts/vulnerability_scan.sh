#!/bin/bash

scan_mode=$1

while IFS= read -r target
do
    ip=$(echo $target | cut -d':' -f1)
    
    if [ "$scan_mode" == "all" ]; then
        nmap --script vuln -p- $ip -T2 --min-rate 50 --max-retries 2 --scan-delay 200ms --max-scan-delay 800ms -oN results/scan_results/${ip}_vuln_scan_all_ports.txt
    else
        port=$(echo $target | cut -d':' -f2)
        nmap --script vuln -p $port $ip -T2 --min-rate 50 --max-retries 2 --scan-delay 200ms --max-scan-delay 800ms -oN results/scan_results/${ip}_vuln_scan.txt
    fi
done < config/targets.txt
